<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Quad-SDK: Robot Driver</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Quad-SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Robot Driver </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Overview</h1>
<p >This package handles the hardware interfacing as well as state estimation. The class interfaces with <a class="el" href="classLegController.html" title="Implements an abstract class for leg controllers.">LegController</a> and <a class="el" href="classStateEstimator.html">StateEstimator</a> abstract classes. These classes provide a template for various implementations of controllers and estimators. The current release supports an inverse dynamics leg controller and a complementary filter state estimator that fuses the IMU and Mocap measurements to estimate the body position and velocity. An EKF implementation will be available soon for on-board state estimation.</p>
<h2>License</h2>
<p >The source code is released under a <a href="quad-sdk/LICENSE">MIT License</a>.</p>
<p >**Author: Joe Norby<br  />
 Affiliation: <a href="https://www.cmu.edu/me/robomechanicslab/">Robomechanics Lab</a><br  />
 Maintainers: Ardalan Tajbakhsh (<a href="#" onclick="location.href='mai'+'lto:'+'ata'+'jb'+'akh'+'@a'+'ndr'+'ew'+'.cm'+'u.'+'edu'; return false;">atajb<span class="obfuscator">.nosp@m.</span>akh@<span class="obfuscator">.nosp@m.</span>andre<span class="obfuscator">.nosp@m.</span>w.cm<span class="obfuscator">.nosp@m.</span>u.edu</a>) **</p>
<p >The Robot Driver package has been tested under <a href="http://www.ros.org">ROS</a> Melodic 18.04. This is research code, expect that it changes often and any fitness for a particular purpose is disclaimed.</p>
<h2>Unit Tests</h2>
<p >Run the unit tests with </p><pre class="fragment">catkin run_tests robot_driver
</pre> <h1>Usage</h1>
<p >Robot driver is called by quad_gazebo.launch and is not meant to be used standalone. <br  />
</p>
<h1>Config files</h1>
<ul>
<li><b>robot_driver.yaml</b> Sets low-level controller and estimator hyperparameters.</li>
</ul>
<h1>Nodes</h1>
<h2>robot_driver</h2>
<pre class="fragment">Robot driver's core functionality is interfacing with the hardware through control and state estimation template classes. In the main loop, the node recieves the most recent local plan, control mode, and computes the updated state using an online state estimator (Complementary filter) as well as the control actions (joint torques) that will be applied to the robot. The control actions are computed using inverse dyanamics from the desired ground reaction forces computed by MPC. Furthermore, robot driver handles the control state machine that decides when to transition between different behaviour modes (For example, safety, sit, stand, etc.).
</pre> <h3>Subscribed Topics</h3>
<ul>
<li><p class="startli">**<code>/local_planner</code>** ([quad_msgs/LocalPlan])</p>
<p class="startli">The current local plan computed by MPC.</p>
</li>
<li><p class="startli">**<code>/control_mode</code>** ([])</p>
<p class="startli">The current control mode of the robot.</p>
</li>
<li>**<code>/single_joint_cmd</code>** ([])</li>
<li><p class="startli">**<code>/remote_heartbeat</code>** ([])</p>
<p class="startli">Robot heartbeat to check if robot is available.</p>
</li>
<li><p class="startli">**<code>/control_restart_flag</code>** ([grid_map_msgs/GridMap])</p>
<p class="startli">Flag that decides when to restart the controller.</p>
</li>
</ul>
<h3>Published Topics</h3>
<ul>
<li><p class="startli">**<code>/leg_command_array</code>** ([quad_msgs/LegCommandArray])</p>
<p class="startli">The motor commands for each leg.</p>
</li>
<li><p class="startli">**<code>/grf_pub</code>** ([quad_msgs/GRFArray])</p>
<p class="startli">The desired ground reaction forces.</p>
</li>
<li>**<code>/robot_heartbeat</code>** ([std_msgs/Header])</li>
<li><p class="startli">**<code>/trajectory_robot_state</code>** ([quad_msgs/RobotState])</p>
<p class="startli">The current state estimate of the robot.</p>
</li>
</ul>
<h3>Parameters</h3>
<ul>
<li><p class="startli">**<code>update_rate</code>** (int, default: 500)</p>
<p class="startli">The update rate of the low-level control and estimation (in Hz).</p>
</li>
<li><p class="startli">**<code>publish_rate</code>** (int, default: 500)</p>
<p class="startli">The number of times to call the robot driver each iteration.</p>
</li>
<li><p class="startli">**<code>mocap_rate</code>** (int, default: 360)</p>
<p class="startli">The update rate for mocap measurements (in Hz)</p>
</li>
<li>**<code>mocap_dropout_threshold</code>** (double, default: 0.027)</li>
<li>**<code>filter_time_constant</code>** (double, default: 0.01)</li>
<li>**<code>filter_time_constant</code>** (double, default: 0.01)</li>
<li>**<code>input_timeout</code>** (double, default: 0.2)</li>
<li>**<code>state_timeout</code>** (double, default: 0.1)</li>
<li>**<code>heartbeat_timeout</code>** (double, default: 0.2)</li>
<li><p class="startli">**<code>sit_kp</code>** (vector, default: [10 10 10])</p>
<p class="startli">Position gains for sit mode.</p>
</li>
<li><p class="startli">**<code>sit_kd</code>** (vector, default: [1 1 1])</p>
<p class="startli">Velocity gains for sit mode.</p>
</li>
<li><p class="startli">**<code>stand_kp</code>** (vector, default: [35 35 35])</p>
<p class="startli">Position gains for stand mode.</p>
</li>
<li><p class="startli">**<code>stand_kd</code>** (vector, default: [1 1 1])</p>
<p class="startli">Velocity gains for stand mode.</p>
</li>
<li><p class="startli">**<code>stance_kp</code>** (vector, default: [10 10 10])</p>
<p class="startli">Position gains for stance legs.</p>
</li>
<li><p class="startli">**<code>stand_kd</code>** (vector, default: [1 1 1])</p>
<p class="startli">Velocity gains for stance legs.</p>
</li>
<li>**<code>swing_kp</code>** (vector, default: [10 10 10])</li>
<li>**<code>swing_kd</code>** (vector, default: [1 1 1])</li>
<li>**<code>swing_kp_cart</code>** (vector, default: [0 0 0]) # N/m</li>
<li>**<code>swing_kd_cart</code>** (vector, default: [0 0 0]) # N/m</li>
<li>**<code>safety_kp</code>** (vector, default: [0 0 0])</li>
<li>**<code>safety_kd</code>** (vector, default: [2 2 2])</li>
<li>**<code>stand_joint_angles</code>** (vector, default: [0.0 0.76 1.52])</li>
<li>**<code>sit_joint_angles</code>** (vector, default: [0.0 0.0 0.0])</li>
</ul>
<h1>Complementary filter coefficients in state-space form,</h1>
<h1>which can be computed by c2d(1/s*(1-G(s))) and c2d(s*G(s)),</h1>
<h1>where G(s) is a second-order low-pass filter</h1>
<ul>
<li>**<code>low_pass_a</code>** (vector, default: [1.863081589528582 -0.871860350323577 1 0])</li>
<li>**<code>low_pass_b</code>** (vector, default: [2 0])</li>
<li>**<code>low_pass_c</code>** (vector, default: [1.469526956982712, -1.476621472298373])</li>
<li>**<code>low_pass_d</code>** (vector, default: [1.616290836790004])</li>
<li>**<code>high_pass_a</code>** (vector, default: [1.901347508294054, -0.905986628426631, 1, 0])</li>
<li>**<code>high_pass_b</code>** (vector, default: [0.062500000000000, 0])</li>
<li>**<code>high_pass_c</code>** (vector, default: [0.031912805108981 -0.028979795079613])</li>
<li>**<code>high_pass_d</code>** (vector, default: [0.0009996017974875904])</li>
</ul>
<h2>Bugs &amp; Feature Requests</h2>
<p >Please report bugs and request features using the <a href="https://github.com/robomechanics/quad-sdk/issues">Issue Tracker</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
